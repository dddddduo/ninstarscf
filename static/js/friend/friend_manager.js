function gmfOperateFormatter(e,t,n){return['<a class="envelope" href="javascript:void(0)" title="发消息">','<i class="glyphicon glyphicon-envelope"></i>',"</a>",'<a class="ban-circle" href="javascript:void(0)" title="拉黑">','<i class="glyphicon glyphicon-ban-circle"></i>',"</a>",'<a class="remove ml10" href="javascript:void(0)" title="删除">','<i class="glyphicon glyphicon-remove"></i>',"</a>",].join("")}function initGetMyFriendTable(e){$("#get_my_friend_table").bootstrapTable({method:"get",cache:!1,height:500,striped:!0,pagination:!0,sidePagination:"client",pageSize:pageSize,pageNumber:1,pageList:[10,20,50,100],search:!0,showColumns:!0,clickToSelect:!0,columns:[{field:"Info_Account",title:"账号",align:"center",valign:"middle",sortable:"true"},{field:"Nick",title:"昵称",align:"center",valign:"middle",sortable:"true"},{field:"Gender",title:"性别",align:"center",valign:"middle",sortable:"true"},{field:"gmfOperate",title:"操作",align:"center",valign:"middle",formatter:"gmfOperateFormatter",events:"gmfOperateEvents",},],data:e,formatNoMatches:function(){return"无符合条件的记录"},})}function sendC2cMsg(){;(toAccount=$("#scm_to_account").val()),(msgtosend=$("#scm_content").val());var e,t,n=webim.Tool.getStrBytes(msgtosend);if(((e=webim.MSG_MAX_LENGTH.C2C),(t="消息长度超出限制(最多"+Math.round(e/3)+"汉字)"),msgtosend.length<1))return alert("发送的消息不能为空!"),void $("#send_msg_text").val("");if(n>e)return void alert(t);var o=webim.MsgStore.sessByTypeId(webim.SESSION_TYPE.C2C,toAccount);o||(o=new webim.Session(webim.SESSION_TYPE.C2C,toAccount,toAccount,friendHeadUrl,Math.round(new Date().getTime()/1e3)));var i,a=!0,r=-1,l=Math.round(4294967296*Math.random()),c=Math.round(new Date().getTime()/1e3);i=webim.C2C_MSG_SUB_TYPE.COMMON
var d,s=new webim.Msg(o,a,r,l,c,loginInfo.identifier,i,loginInfo.identifierNick);(d=new webim.Msg.Elem.Text(msgtosend)),s.addText(d),webim.sendMsg(s,function(e){if(selToID)if(selToID==toAccount){addMsg(s)}else{var t=document.getElementById("sessDiv_"+toAccount);t||addSess(webim.SESSION_TYPE.C2C,toAccount,toAccount,friendHeadUrl,0,"sesslist"),onSelSess(webim.SESSION_TYPE.C2C,toAccount)}else
(selType=webim.SESSION_TYPE.C2C),(selToID=toAccount),(selSess=o),addSess(selType,toAccount,toAccount,friendHeadUrl,0,"sesslist"),setSelSessStyleOn(toAccount),addMsg(s);webim.Tool.setCookie("tmpmsg_"+toAccount,"",0),$("#scm_content").val(""),$("#send_c2c_msg_dialog").modal("hide"),$("#get_my_friend_dialog").modal("hide")},function(e){alert(e.ErrorInfo),$("#scm_content").val("")})}window.gmfOperateEvents={"click .envelope":function(e,t,n,o){$("#scm_to_account").val(n.Info_Account),$("#send_c2c_msg_dialog").modal("show")},"click .ban-circle":function(e,t,n,o){confirm("确定将该好友拉黑吗？")&&addBlackList(n.Info_Account)},"click .remove":function(e,t,n,o){$("#df_to_account").val(n.Info_Account),$("#delete_friend_dialog").modal("show")},};var applyAddFriend=function(){var e=webim.Tool.getStrBytes($("#af_add_wording").val());if(e>120){return void alert("您输入的附言超过字数限制(最长40个汉字)")}var t=[{To_Account:$("#af_to_account").val(),AddSource:"AddSource_Type_Unknow",AddWording:$("#af_add_wording").val()},],n={From_Account:loginInfo.identifier,AddFriendItem:t};webim.applyAddFriend(n,function(e){if(e.Fail_Account&&e.Fail_Account.length>0)for(var t in e.ResultItem){alert(e.ResultItem[t].ResultInfo);break}else"允许任何人"==$("#af_allow_type").val()?alert("添加好友成功"):($("#add_friend_dialog").modal("hide"),alert("申请添加好友成功"))},function(e){alert(e.ErrorInfo)})},deleteFriend=function(){if(confirm("确定删除该好友吗？")){var e=[];if(((e=[$("#df_to_account").val()]),!(e.length<=0))){var t={From_Account:loginInfo.identifier,To_Account:e,DeleteType:$('input[name="df_type_radio"]:checked').val()};webim.deleteFriend(t,function(e){$("#get_my_friend_table").bootstrapTable("remove",{field:"Info_Account",values:[$("#df_to_account").val()]}),deleteSessDiv(webim.SESSION_TYPE.C2C,$("#df_to_account").val()),$("#delete_friend_dialog").modal("hide"),alert("删除好友成功")},function(e){alert(e.ErrorInfo)})}}},getMyFriend=function(){initGetMyFriendTable([]);var e={From_Account:loginInfo.identifier,TimeStamp:0,StartIndex:0,GetCount:totalCount,LastStandardSequence:0,TagList:["Tag_Profile_IM_Nick","Tag_SNS_IM_Remark","Tag_Profile_IM_Gender"],};webim.getAllFriend(e,function(e){if(e.FriendNum>0){var t=[],n=e.InfoItem
if(!n||0==n.length)return void alert("你目前还没有好友");for(var o=n.length,i=0;i<o;i++){var a=n[i].Info_Account,r="未知";if(n[i].SnsProfileItem)for(var l in n[i].SnsProfileItem)switch(n[i].SnsProfileItem[l].Tag){case"Tag_Profile_IM_Nick":a=n[i].SnsProfileItem[l].Value
break
case"Tag_Profile_IM_Gender":switch(n[i].SnsProfileItem[l].Value){case"Gender_Type_Male":r="男";break
case"Gender_Type_Female":r="女";break
case"Gender_Type_Unknown":r="未知"}}t.push({Info_Account:n[i].Info_Account,Nick:webim.Tool.formatText2Html(a),Gender:r})}$("#get_my_friend_table").bootstrapTable("load",t),$("#get_my_friend_dialog").modal("show")}else alert("您目前还没有好友")},function(e){alert(e.ErrorInfo)})},initInfoMapByMyFriends=function(e){var t={From_Account:loginInfo.identifier,TimeStamp:0,StartIndex:0,GetCount:totalCount,LastStandardSequence:0,TagList:["Tag_Profile_IM_Nick","Tag_Profile_IM_Image"],};webim.getAllFriend(t,function(t){if(t.FriendNum>0){var n=t.InfoItem
if(!n||0==n.length)return void(e&&e());for(var o=n.length,i=0;i<o;i++){var a=n[i],r=a.Info_Account,l=(friend_image="");for(var c in a.SnsProfileItem)switch(a.SnsProfileItem[c].Tag){case"Tag_Profile_IM_Nick":l=a.SnsProfileItem[c].Value
break
case"Tag_Profile_IM_Image":friend_image=a.SnsProfileItem[c].Value}var d=webim.SESSION_TYPE.C2C+"_"+r
infoMap[d]={name:l,image:friend_image}}e&&e()}},function(e){alert(e.ErrorInfo)})}